name: Build Audio Editor EXE

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]
  release:
    types: [ published ]

jobs:
  build-windows:
    runs-on: windows-latest
    
    steps:
    - uses: actions/checkout@v4
    
    - name: Set up Python
      uses: actions/setup-python@v5
      with:
        python-version: '3.11'
    
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt
        pip install pyinstaller
    
    - name: Build EXE with PyInstaller
      run: |
          pyinstaller --onefile --windowed --name "AudioEditor_v1.0.5" audio_recorder_editor.py
    
    - name: Upload EXE artifacts
      uses: actions/upload-artifact@v4
      with:
        name: audio-editor-exe
        path: dist/AudioEditor_v1.0.5.exe

    - name: Show EXE files info
      if: always()
      run: |
        echo "üéâ EXE —Ñ–∞–π–ª –∑—ñ–±—Ä–∞–Ω–æ —É—Å–ø—ñ—à–Ω–æ!"
        echo "üìÅ –§–∞–π–ª –∑–Ω–∞—Ö–æ–¥–∏—Ç—å—Å—è –≤ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–∞—Ö:"
        if (Test-Path "dist/AudioEditor_v1.0.5.exe") {
        $size = (Get-Item "dist/AudioEditor_v1.0.5.exe").Length / 1MB
        echo "   üìÑ AudioEditor_v1.0.5.exe ($([math]::Round($size, 1)) MB)"
        }
        echo ""
        echo "üí° –î–ª—è —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è Release:"
        echo "   1. –ü–µ—Ä–µ–π–¥—ñ—Ç—å –≤ 'Releases' –Ω–∞ GitHub"
        echo "   2. –ù–∞—Ç–∏—Å–Ω—ñ—Ç—å 'Create a new release'"
        echo "   3. –ó–∞–≤–∞–Ω—Ç–∞–∂—Ç–µ EXE —Ñ–∞–π–ª–∏ –∑ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç—ñ–≤"

    - name: Create Release
      if: github.event_name == 'push'
      uses: softprops/action-gh-release@v1
      with:
        tag_name: v1.0.5
        name: Audio Editor v1.0.5
        body: |
          üéµ **–ê—É–¥—ñ–æ –†–µ–∫–æ—Ä–¥–µ—Ä —Ç–∞ –†–µ–¥–∞–∫—Ç–æ—Ä v1.0.5**
          
          ## üì¶ –©–æ –≤–∫–ª—é—á–µ–Ω–æ:
          - **AudioEditor_v1.0.5.exe** - –ì—Ä–∞—Ñ—ñ—á–Ω–∞ –≤–µ—Ä—Å—ñ—è (PyQt5)

          ## üöÄ –Ø–∫ –∑–∞–ø—É—Å—Ç–∏—Ç–∏:
          1. –ó–∞–≤–∞–Ω—Ç–∞–∂—Ç–µ EXE —Ñ–∞–π–ª
          2. –í—Å—Ç–∞–Ω–æ–≤—ñ—Ç—å ffmpeg –¥–ª—è MP3/OGG/FLAC
          3. –ó–∞–ø—É—Å—Ç—ñ—Ç—å –±–µ–∑ –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è Python
          4. –ù–∞—Å–æ–ª–æ–¥–∂—É–π—Ç–µ—Å—å —Ä–æ–±–æ—Ç–æ—é –∑ –∞—É–¥—ñ–æ!

        files: dist/AudioEditor_v1.0.5.exe
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}