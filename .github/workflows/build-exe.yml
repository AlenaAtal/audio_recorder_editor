name: Build Audio Editor EXE

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]
  release:
    types: [ published ]

jobs:
  build-windows:
    runs-on: windows-latest
    
    steps:
    - uses: actions/checkout@v4
    
    - name: Set up Python
      uses: actions/setup-python@v5
      with:
        python-version: '3.11'
    
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt
        pip install pyinstaller
    
    - name: Build EXE with PyInstaller
      run: |
        pyinstaller --onefile --windowed --name "AudioEditor_v1.0.4" audio_recorder_editor.py
        pyinstaller --onefile --name "AudioEditor_Console_v1.0.4" audio_editor_replit.py
    
    - name: Upload EXE artifacts
      uses: actions/upload-artifact@v4
      with:
        name: audio-editor-exe
        path: |
          dist/AudioEditor_v1.0.4.exe
          dist/AudioEditor_Console_v1.0.4.exe
    
    - name: Show EXE files info
      if: always()
      run: |
        echo "üéâ EXE —Ñ–∞–π–ª–∏ –∑—ñ–±—Ä–∞–Ω–æ —É—Å–ø—ñ—à–Ω–æ!"
        echo "üìÅ –§–∞–π–ª–∏ –∑–Ω–∞—Ö–æ–¥—è—Ç—å—Å—è –≤ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–∞—Ö:"
        if (Test-Path "dist/AudioEditor_v1.0.4.exe") {
          $size = (Get-Item "dist/AudioEditor_v1.0.4.exe").Length / 1MB
          echo "   üìÑ AudioEditor_v1.0.4.exe ($([math]::Round($size, 1)) MB)"
        }
        if (Test-Path "dist/AudioEditor_Console_v1.0.4.exe") {
          $size = (Get-Item "dist/AudioEditor_Console_v1.0.4.exe").Length / 1MB
          echo "   üìÑ AudioEditor_Console_v1.0.4.exe ($([math]::Round($size, 1)) MB)"
        }
        echo ""
        echo "üí° –î–ª—è —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è Release:"
        echo "   1. –ü–µ—Ä–µ–π–¥—ñ—Ç—å –≤ 'Releases' –Ω–∞ GitHub"
        echo "   2. –ù–∞—Ç–∏—Å–Ω—ñ—Ç—å 'Create a new release'"
        echo "   3. –ó–∞–≤–∞–Ω—Ç–∞–∂—Ç–µ EXE —Ñ–∞–π–ª–∏ –∑ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç—ñ–≤"
