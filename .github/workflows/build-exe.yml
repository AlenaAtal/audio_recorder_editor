name: Build Audio Editor EXE

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]
  release:
    types: [ published ]

jobs:
  build-windows:
    runs-on: windows-latest
    
    steps:
    - uses: actions/checkout@v4
    
    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.11'
    
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt
        pip install pyinstaller
    
    - name: Build EXE with PyInstaller
      run: |
        pyinstaller --onefile --windowed --name "AudioEditor_v1.0.4" audio_recorder_editor.py
        pyinstaller --onefile --name "AudioEditor_Console_v1.0.4" audio_editor_replit.py
    
    - name: Upload EXE artifacts
      uses: actions/upload-artifact@v3
      with:
        name: audio-editor-exe
        path: |
          dist/AudioEditor_v1.0.4.exe
          dist/AudioEditor_Console_v1.0.4.exe
    
    - name: Create Release
      if: github.event_name == 'push' && github.ref == 'refs/heads/main'
      uses: softprops/action-gh-release@v1
      with:
        tag_name: v1.0.4
        name: Audio Editor v1.0.4
        body: |
          üéµ **–ê—É–¥—ñ–æ –†–µ–∫–æ—Ä–¥–µ—Ä —Ç–∞ –†–µ–¥–∞–∫—Ç–æ—Ä v1.0.4**
          
          ## üì¶ –©–æ –≤–∫–ª—é—á–µ–Ω–æ:
          - **AudioEditor_v1.0.4.exe** - –ì—Ä–∞—Ñ—ñ—á–Ω–∞ –≤–µ—Ä—Å—ñ—è (PyQt5)
          - **AudioEditor_Console_v1.0.4.exe** - –ö–æ–Ω—Å–æ–ª—å–Ω–∞ –≤–µ—Ä—Å—ñ—è
          
          ## üÜï –ù–æ–≤—ñ —Ñ—É–Ω–∫—Ü—ñ—ó v1.0.4:
          - ‚úÖ –ü–æ–∫—Ä–∞—â–µ–Ω–æ —à—É–º–æ–ø–æ–¥–∞–≤–ª–µ–Ω–Ω—è
          - ‚úÖ –î–æ–¥–∞–Ω–æ –∫–Ω–æ–ø–∫—É "–í—ñ–¥—Ç–≤–æ—Ä–∏—Ç–∏ –∑ EQ"
          - ‚úÖ –í–∏–ø—Ä–∞–≤–ª–µ–Ω–æ –ø–æ–≤—Ç–æ—Ä–µ–Ω–Ω—è –∑–≤—É–∫—É
          - ‚úÖ –ü–µ—Ä–µ–∫–ª–∞–¥–µ–Ω–æ —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å –Ω–∞ —É–∫—Ä–∞—ó–Ω—Å—å–∫—É
          
          ## üöÄ –Ø–∫ –∑–∞–ø—É—Å—Ç–∏—Ç–∏:
          1. –ó–∞–≤–∞–Ω—Ç–∞–∂—Ç–µ –ø–æ—Ç—Ä—ñ–±–Ω–∏–π exe —Ñ–∞–π–ª
          2. –ó–∞–ø—É—Å—Ç—ñ—Ç—å –±–µ–∑ –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è Python
          3. –ù–∞—Å–æ–ª–æ–¥–∂—É–π—Ç–µ—Å—å —Ä–æ–±–æ—Ç–æ—é –∑ –∞—É–¥—ñ–æ!
          
          ## üìã –ü—ñ–¥—Ç—Ä–∏–º—É–≤–∞–Ω—ñ —Ñ–æ—Ä–º–∞—Ç–∏:
          - **–í—Ö—ñ–¥–Ω—ñ**: WAV, MP3, FLAC, OGG
          - **–í–∏—Ö—ñ–¥–Ω—ñ**: WAV, MP3
        files: |
          dist/AudioEditor_v1.0.4.exe
          dist/AudioEditor_Console_v1.0.4.exe
        draft: false
        prerelease: false
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
